<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="icon" href="../image/QoQ.png" type="image/png">
    <title>植物多樣性地圖</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Leaflet 樣式 -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
     integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>

    <!-- 自訂樣式 -->
    <style>
        html, body {
            height: 90%;
            margin: 0;
            padding: 0;
        }

        #map {
            height: 80vh;
        }

        .leaflet-control-colorbar {
            padding: 10px;
            background: white;
            font-size: 12px;
            line-height: 1.2;
            border-radius: 4px;
            box-shadow: 0 0 5px rgba(0,0,0,0.3);
        }

        .colorbar-gradient {
            width: 20px;
            height: 150px;
            margin-right: 8px;
            border: 1px solid #999;
            display: inline-block;
            vertical-align: middle;
        }
    </style>
</head>

<body class="h-screen flex flex-col">

    <!-- 導覽列 -->
    <nav class="bg-gray-800 text-white px-6 py-3 flex space-x-6 shadow-md">
        <a href="index.html" class="hover:text-yellow-300">簡介</a>
        <a href="webtest.html" class="hover:text-yellow-300 transition">地圖</a>
        <a href="analysis.html" class="hover:text-yellow-300">研究方法</a>
        <a href="reference.html" class="hover:text-yellow-300 transition">參考資料</a>
        <a href="aboutus.html" class="hover:text-yellow-300 transition">關於我們</a>
    </nav>

    <!-- 地圖容器：使用 flex-1 讓地圖自動撐滿剩餘空間 -->
    <div id="map" class="flex-1"></div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
     integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin="">
    </script>

    <script>
        // -------------------------------------------------------------------
        // 1. 初始化地圖
        // -------------------------------------------------------------------
        var map = L.map('map').setView([-34.5, 19.6], 9);

        // -------------------------------------------------------------------
        // 2. 設定底圖圖層
        // -------------------------------------------------------------------
        var layer_google = L.tileLayer('http://mt0.google.com/vt/lyrs=m&hl=en&x={x}&y={y}&z={z}&s=Ga');
        var layer_osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png');

        layer_google.addTo(map);

        // -------------------------------------------------------------------
        // 3. 圖層控制器
        // -------------------------------------------------------------------
        var baseLayers = {
            "Google 地圖": layer_google,
            "OSM 地圖": layer_osm
        };
        L.control.layers(baseLayers).addTo(map);

        // -------------------------------------------------------------------
        // 4. Colorbar 建立函式
        // -------------------------------------------------------------------
        function createColorbar(gradientCSS, labelHigh, labelLow) {
            var control = L.control({ position: 'bottomright' });
            control.onAdd = function() {
                var div = L.DomUtil.create('div', 'leaflet-control-colorbar bg-white p-3 rounded shadow-md text-sm leading-tight flex items-center space-x-2');

                div.innerHTML =
                    '<div class="colorbar-gradient" style="background:' + gradientCSS + '; width:20px; height:150px; border:1px solid #999;"></div>' +
                    '<div class="flex flex-col justify-between h-[150px]">' +
                    '  <span>' + labelHigh + '</span>' +
                    '  <span class="mt-auto">' + labelLow + '</span>' +
                    '</div>';

                return div;
            };
            return control;
        }

        // -------------------------------------------------------------------
        var colorbar_google = createColorbar(
            "linear-gradient(to top, blue, cyan, yellow, orange, red)",
            "高", "低"
        );

        var colorbar_osm = createColorbar(
            "linear-gradient(to top, purple, pink, white)",
            "多", "少"
        );

        colorbar_google.addTo(map);

        map.on('baselayerchange', function(e) {
            map.removeControl(colorbar_google);
            map.removeControl(colorbar_osm);

            if (e.name === "Google 地圖") colorbar_google.addTo(map);
            if (e.name === "OSM 地圖") colorbar_osm.addTo(map);
        });
    </script>

</body>
</html>